<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cartographie FP R√©union 2026 ‚Äî Mind map + Carte</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    :root{
      --c0:#000000;  /* noir */
      --c1:#fc772c;  /* orange */
      --c2:#5c646b;  /* gris */
      --c3:#f1d7bc;  /* beige */
      --c4:#ce2a45;  /* rouge */

      --textOnDark: rgba(255,255,255,.92);
      --mutedOnDark: rgba(255,255,255,.72);

      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --shadowSoft: 0 14px 45px rgba(0,0,0,.35);

      --ease:cubic-bezier(.2,.85,.25,1);
      --dur:260ms;
      --radius: 18px;

      --hub: clamp(104px, 10vw, 140px);
      --node: clamp(102px, 12vw, 150px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--textOnDark);
      overflow-x:hidden;
      background:
        radial-gradient(900px 600px at 18% 22%, rgba(252,119,44,.20), transparent 60%),
        radial-gradient(900px 700px at 78% 20%, rgba(206,42,69,.20), transparent 55%),
        radial-gradient(1100px 900px at 50% 92%, rgba(92,100,107,.18), transparent 60%),
        linear-gradient(135deg, rgba(0,0,0,1), rgba(0,0,0,1));
      min-height:100vh;
    }

    /* d√©cor */
    .bg-shapes{position:fixed; inset:0; pointer-events:none; opacity:.95;}
    .plus{position:absolute; width:34px; height:34px; opacity:.65; filter: drop-shadow(0 10px 25px rgba(0,0,0,.6));}
    .plus:before,.plus:after{content:""; position:absolute; inset:0; margin:auto; background:rgba(252,119,44,.65); border-radius:2px;}
    .plus:before{width:6px; height:34px;}
    .plus:after{width:34px; height:6px;}
    .tri{position:absolute; width:0; height:0; border-left:16px solid transparent; border-right:16px solid transparent; border-bottom:26px solid rgba(241,215,188,.20); transform: rotate(-18deg); opacity:.7;}
    .ring{position:absolute; width:46px; height:46px; border:6px solid rgba(206,42,69,.35); border-right-color: transparent; border-top-color: transparent; border-radius:999px; opacity:.70;}

    header{
      padding: 18px 18px 10px;
      max-width: 1400px;
      margin: 0 auto;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
    }
    header h1{margin:0; font-size: clamp(18px, 2.1vw, 28px)}
    header p{margin:6px 0 0; color: var(--mutedOnDark); font-size: 14px; line-height:1.45; max-width: 92ch}

    .switch{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .chip{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      transition: transform var(--dur) var(--ease), background var(--dur) var(--ease);
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }
    .chip:hover{transform: translateY(-1px); background: rgba(255,255,255,.14)}
    .chip.active{
      background: linear-gradient(90deg, rgba(252,119,44,.95), rgba(206,42,69,.90));
      border-color: rgba(255,255,255,.22);
    }

    .wrap{max-width: 1400px; margin: 0 auto; padding: 10px 18px 18px;}
    .view{display:none;}
    .view.active{display:block;}
    .card{
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    /* =======================
      VIEW 1 ‚Äî MIND MAP (PAYSAGE)
    ======================= */
    .mm-grid{
      display:grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto auto;
      gap: 14px;
      align-items:stretch;
    }

    .mindmap{
      position:relative;
      border-radius: var(--radius);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 520px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 14px;
      backdrop-filter: blur(10px);
    }

    .stage{
      position:relative;
      width: min(1180px, 100%);
      aspect-ratio: 16 / 9;
      display:grid;
      place-items:center;
    }

    .blob{
      position:absolute;
      width: 240px; height: 170px;
      background: rgba(241,215,188,.10);
      border: 1px solid rgba(241,215,188,.10);
      border-radius: 62% 38% 55% 45% / 45% 60% 40% 55%;
      box-shadow: 0 25px 80px rgba(0,0,0,.35);
      opacity:.65;
      z-index:0;
    }

    svg.connectors{position:absolute; inset:0; width:100%; height:100%; z-index:1; pointer-events:none; overflow:visible;}
    .link{
      stroke: rgba(241,215,188,.35);
      stroke-width: 2;
      fill:none;
      stroke-linecap:round;
      stroke-dasharray: 8 8;
      opacity:.85;
      transition: opacity var(--dur) var(--ease), stroke-dasharray var(--dur) var(--ease), stroke var(--dur) var(--ease);
    }
    .link.is-active{opacity:1; stroke-dasharray:none; stroke: rgba(252,119,44,.95);}

    .hub{
      position:relative;
      width: var(--hub);
      height: var(--hub);
      border-radius: 55% 45% 60% 40% / 45% 58% 42% 55%;
      background: linear-gradient(180deg, rgba(241,215,188,.98), rgba(241,215,188,.90));
      box-shadow: var(--shadowSoft);
      border: 1px solid rgba(0,0,0,.10);
      display:grid;
      place-items:center;
      padding: 10px;
      z-index:3;
      color: #000;
    }
    .hub .center-title{font-weight: 950; font-size: clamp(12px, 1.4vw, 15px); line-height:1.15; text-align:center;}

    /* Bulles */
    .node{
      position:absolute;
      width: var(--node);
      height: var(--node);
      border-radius: 60% 40% 54% 46% / 42% 58% 42% 58%;
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: var(--shadowSoft);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 12px;
      cursor:pointer;
      user-select:none;
      z-index:2;
      transform: translate(-50%,-50%) translateZ(0);
      transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease), filter var(--dur) var(--ease);
      outline:none;
    }
    .node:hover{transform: translate(-50%,-50%) scale(1.04); filter: brightness(1.03); box-shadow: 0 18px 45px rgba(0,0,0,.45);}
    .node.is-active{transform: translate(-50%,-50%) scale(1.08); box-shadow: 0 22px 55px rgba(0,0,0,.55); outline: 2px solid rgba(252,119,44,.70);}

    .node .tag{
      position:absolute; top:-12px; left:12px;
      display:flex; align-items:center; gap:8px;
      padding: 7px 10px; border-radius: 12px;
      color:#fff; font-weight:950; font-size: 11px;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      letter-spacing:.2px; white-space:nowrap;
    }
    .node .tag .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.92);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.12);
    }
    .node .label{
      font-weight: 950;
      font-size: 13px;
      line-height:1.15;
      padding-top: 10px;
      color: inherit;
      text-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .node .mini{
      display:block;
      margin-top:6px;
      font-size: 11px;
      font-weight: 900;
      opacity: .88;
      color: inherit;
    }

    .panel{
      border-radius: var(--radius);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      min-height: 380px;
    }
    .panel-header{
      background: linear-gradient(90deg, rgba(252,119,44,.95), rgba(206,42,69,.90));
      padding: 14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .panel-header h2{margin:0; font-size: 14px; letter-spacing:.2px;}

    .panel-body{
      padding: 16px;
      overflow:auto;
      flex:1;
      max-height: 360px;
    }
    .mm-card{
      background: linear-gradient(180deg, rgba(241,215,188,.98), rgba(241,215,188,.90));
      color: #000;
      border-radius: 22px;
      padding: 14px;
      box-shadow: var(--shadowSoft);
      border: 1px solid rgba(0,0,0,.10);
      transform-origin: top;
      transition: transform var(--dur) var(--ease), opacity var(--dur) var(--ease);
    }
    .mm-card.is-enter{opacity:0; transform: translateY(8px) scale(.98);}

    .mm-layout{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 14px;
      align-items:start;
    }
    .mm-left h3{margin:0 0 8px; font-size: 15px; letter-spacing:.2px;}
    .mm-left p{margin:0 0 10px; color: rgba(0,0,0,.82); font-size: 13px; line-height:1.45;}
    .mm-left ul{margin: 0 0 10px; padding-left: 18px; color: rgba(0,0,0,.82); font-size: 13px; line-height:1.45;}
    .mm-left li{margin: 6px 0}
    .mm-left h4{margin:14px 0 8px; font-size:13px; letter-spacing:.2px; color:#000;}

    .mm-right{display:flex; flex-direction:column; gap: 10px;}
    .sidebox{
      background: rgba(0,0,0,.06);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 12px;
    }
    .sidebox .title{
      font-weight: 950;
      font-size: 12px;
      letter-spacing:.2px;
      margin:0 0 8px;
      color: rgba(0,0,0,.90);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill-row{display:flex; flex-wrap:wrap; gap:8px;}
    .pill{
      background: linear-gradient(90deg, rgba(92,100,107,.95), rgba(0,0,0,.92));
      border: 1px solid rgba(0,0,0,.18);
      color:#fff;
      font-weight: 950;
      font-size: 11px;
      padding: 7px 10px;
      border-radius: 999px;
      box-shadow: 0 14px 30px rgba(0,0,0,.18);
    }

    .actions{display:grid; grid-template-columns: 1fr; gap: 8px;}
    .action{
      display:flex; flex-direction: column; gap:4px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.50);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
      font-weight: 900;
      font-size: 12px;
    }
    .action span b { color: var(--c4); }
    .action small{font-weight: 800; color: rgba(0,0,0,.65); line-height: 1.2;}
    .action .k{
      display: inline-block;
      width: fit-content;
      font-weight: 950;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(252,119,44,.20);
      border: 1px solid rgba(252,119,44,.25);
      margin-top: 4px;
    }

    .panel-footer{
      padding: 12px 16px 14px;
      display:flex; gap:10px; flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
    }
    .btn{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#fff;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      transition: transform var(--dur) var(--ease), background var(--dur) var(--ease);
    }
    .btn.primary{
      background: linear-gradient(90deg, rgba(252,119,44,.95), rgba(206,42,69,.90));
      border-color: rgba(255,255,255,.22);
    }

    /* =======================
      VIEW 2 ‚Äî CARTE + TABLE
    ======================= */
    .map-grid{display:grid; grid-template-columns: 1.35fr .85fr; gap: 14px; align-items:stretch;}
    #map{width:100%; min-height: 650px;}
    .side{display:flex; flex-direction:column; min-height: 650px;}

    .table-wrap{padding: 10px 14px 14px; overflow:auto; flex:1;}
    table{width:100%; border-collapse: collapse; font-size: 12.5px;}
    th, td{padding: 10px 8px; border-bottom: 1px solid rgba(255,255,255,.10); vertical-align:top; text-align:left;}

    @media (max-width: 1050px){
      .map-grid{grid-template-columns: 1fr}
      .mm-layout{grid-template-columns: 1fr;}
    }

    @media print {
      .bg-shapes, .switch, .panel-footer { display:none !important; }
      body { background: #fff !important; color:#000 !important; }
    }
  </style>
</head>

<body>
  <div class="bg-shapes" aria-hidden="true">
    <div class="plus" style="top:12%; left:86%;"></div>
    <div class="ring" style="top:24%; left:10%;"></div>
  </div>

  <header>
    <div>
      <h1>Cartographie acteurs FP R√©union (2026)</h1>
      <p>Outil interactif de visualisation des acteurs de la formation.</p>
    </div>
    <div class="switch">
      <button class="chip active" id="btnMind">üß† Mind map</button>
      <button class="chip" id="btnMap">üó∫Ô∏è Carte + table</button>
    </div>
  </header>

  <div class="wrap">
    <section class="view active" id="viewMind">
      <div class="mm-grid">
        <div class="mindmap card">
          <div class="stage" id="mmStage">
            <svg class="connectors" id="mmSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none"></svg>
            <div class="hub" id="mmHub">
              <div class="center-title" id="mmCenterTitle">Acteurs formation pro<br>R√©union (2026)</div>
            </div>
          </div>
        </div>

        <aside class="panel">
          <div class="panel-header">
            <h2 id="mmPanelTitle">Introduction</h2>
            <div class="badge" id="mmPanelBadge">Interactif</div>
          </div>
          <div class="panel-body">
            <div class="mm-card" id="mmCard">
                </div>
          </div>
          <div class="panel-footer">
            <button class="btn primary" id="mmResetBtn">Retour intro</button>
            <button class="btn" id="mmPdfBtn">üìÑ Exporter PDF</button>
          </div>
        </aside>
      </div>
    </section>

    <section class="view" id="viewMap">
      <div class="map-grid">
        <div class="card" id="map"></div>
        <div class="card side">
            <div class="table-wrap">
                <table>
                  <thead><tr><th>Acteur</th><th>Commune</th></tr></thead>
                  <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    function escapeHTML(str){
      return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    /* DATA */
    const MM_DATA = {
      centerTitle: "Acteurs formation pro ‚Äî R√©union (2026)",
      branches: [
        { id:"b1", cat:"PILOTAGE", title:"Pilotage & contr√¥le", subtitle:"Institutionnel / contr√¥le OF", icon:"üèõÔ∏è",
          content:{ intro:"Instances de pilotage et contr√¥le r√©gionales.",
            sections:[{heading:"R√¥les", bullets:["Contr√¥le de la qualit√© des OF","Agr√©ment et certifications"]}],
            pills:["DEETS","R√©gion","√âtat"] } },
        { id:"b2", cat:"FINANCEUR", title:"Financeurs (OPCO)", subtitle:"11 OPCO nationaux", icon:"üí∂",
          content:{ intro:"Financeurs par branches professionnelles.",
            sections:[{heading:"Exemples", bullets:["AKTO","OPCO Mobilit√©s","OPCO Atlas"]}],
            pills:["OPCO","Finances"] } },
        { id:"b3", cat:"OF", title:"Organismes de formation", subtitle:"CFA & OF logistique", icon:"üè´",
          content:{ intro:"Centres de formation sp√©cialis√©s.",
            sections:[{heading:"Sud", bullets:["AFTRAL","AREFIP"]}],
            pills:["CFA","OF"] } }
      ]
    };

    /* RENDU */
    const mmCard = document.getElementById("mmCard");

    function mmRender(branch) {
      mmCard.classList.add("is-enter");
      
      const sectionsHTML = (branch.content.sections || []).map(sec => `
        <h4>${escapeHTML(sec.heading)}</h4>
        <ul>${(sec.bullets || []).map(li => `<li>${escapeHTML(li)}</li>`).join("")}</ul>
      `).join("");

      const pillsHTML = (branch.content.pills || []).map(p => `<span class="pill">${escapeHTML(p)}</span>`).join("");

      // CONDITION D'AFFICHAGE (Modification demand√©e)
      const rightContent = branch.id === "b1" ? `
        <div class="sidebox">
          <p class="title">üìç Coordonn√©es</p>
          <div class="actions">
            <div class="action"><span><b>DEETS</b> ‚Äî Si√®ge</span><small>112 rue de la R√©publique, 97400 Saint-Denis</small></div>
            <div class="action"><span><b>DEETS</b> ‚Äî T√©l√©phone</span><span class="k">02 62 94 07 07</span></div>
            <div class="action"><span><b>DEETS</b> ‚Äî Email</span><small>deets-974.direction@deets.gouv.fr</small></div>
            <div class="action"><span><b>DEETS</b> ‚Äî R√¥les cl√©s</span><small>Contr√¥le OF / Agr√©ments / VAE</small></div>
            <div class="action"><span><b>R√©gion R√©union</b> ‚Äî Site</span><small>regionreunion.com</small></div>
          </div>
        </div>
      ` : `
        <div class="sidebox">
          <p class="title">‚ö° Actions</p>
          <div class="actions">
            <div class="action"><span>Modifier le contenu</span><span class="k">MM_DATA</span></div>
            <div class="action"><span>Ajouter des acteurs</span><span class="k">ACTEURS</span></div>
            <div class="action"><span>Exporter en PDF</span><span class="k">Print</span></div>
          </div>
        </div>
      `;

      setTimeout(() => {
        mmCard.innerHTML = `
          <div class="mm-layout">
            <div class="mm-left">
              <h3>${escapeHTML(branch.icon)} ${escapeHTML(branch.title)}</h3>
              <p>${escapeHTML(branch.content.intro || "")}</p>
              ${sectionsHTML}
            </div>
            <div class="mm-right">
              <div class="sidebox">
                <p class="title">üè∑Ô∏è Tags</p>
                <div class="pill-row">${pillsHTML}</div>
              </div>
              ${rightContent}
            </div>
          </div>
        `;
        mmCard.classList.remove("is-enter");
      }, 50);
    }

    /* INITIALISATION NOEUDS */
    function createNodes() {
        const stage = document.getElementById("mmStage");
        MM_DATA.branches.forEach((b, i) => {
            const btn = document.createElement("button");
            btn.className = "node";
            btn.style.left = (20 + i * 30) + "%";
            btn.style.top = "30%";
            btn.style.background = "#fc772c";
            btn.style.color = "#fff";

            // √âtiquette demand√©e
            btn.innerHTML = `
                <div class="tag" style="background:#000">
                    <span class="dot"></span>
                    <span>${b.icon} ${b.title} DREETS et R√©gion R√©union</span>
                </div>
                <div class="label">${b.title}<span class="mini">${b.subtitle}</span></div>
            `;
            btn.onclick = () => mmRender(b);
            stage.appendChild(btn);
        });
    }

    createNodes();
    mmRender(MM_DATA.branches[0]);

    // Switch Vue
    document.getElementById("btnMap").onclick = () => {
        document.getElementById("viewMind").classList.remove("active");
        document.getElementById("viewMap").classList.add("active");
    };
  </script>
</body>
</html>
